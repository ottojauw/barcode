<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .barcode-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 4px;
        }
        .barcode-text {
            margin-top: 15px;
            font-size: 18px;
            color: #555;
        }
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        .error {
            color: #d32f2f;
            text-align: center;
            padding: 20px;
            background: #ffebee;
            border-radius: 4px;
        }
        img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Barcode Display</h1>
        <div id="content" class="loading">Loading barcode...</div>
    </div>

    <script>
        // Get parameters from query string
        const urlParams = new URLSearchParams(window.location.search);
        const barcodeText = urlParams.get('text');
        const barcodeType = urlParams.get('type') || 'CODE128';
        const barcodeWidth = urlParams.get('width') || '2';
        const barcodeHeight = urlParams.get('height') || '100';
        const contentDiv = document.getElementById('content');

        if (barcodeText) {
            // Create a hidden iframe to load the generator
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            
            // Construct URL to the generator page with all parameters
            const generatorUrl = 'barcode-generator.html?text=' + encodeURIComponent(barcodeText) +
                                '&type=' + encodeURIComponent(barcodeType) +
                                '&width=' + encodeURIComponent(barcodeWidth) +
                                '&height=' + encodeURIComponent(barcodeHeight);
            
            iframe.onload = function() {
                try {
                    // Get the base64 string from the iframe's window object
                    const base64Image = iframe.contentWindow.barcodeBase64;
                    console.log("___ base64Image: "+base64Image);
                    
                    if (base64Image && base64Image.startsWith('data:image')) {
                        // Display the barcode image
                        contentDiv.innerHTML = `
                            <div class="barcode-container">
                                <img src="${base64Image}" alt="Barcode for ${barcodeText}">
                                <div class="barcode-text">
                                    <strong>Text:</strong> ${barcodeText}<br>
                                    <strong>Type:</strong> ${barcodeType}<br>
                                    <strong>Width:</strong> ${barcodeWidth} | <strong>Height:</strong> ${barcodeHeight}
                                </div>
                            </div>
                        `;
                    } else {
                        // Try to get error message from iframe body
                        const errorMsg = iframe.contentWindow.document.body.textContent;
                        contentDiv.className = 'error';
                        contentDiv.innerHTML = `Error: ${errorMsg || 'Failed to generate barcode'}`;
                    }
                    
                    // Remove the iframe after a short delay
                    setTimeout(() => document.body.removeChild(iframe), 100);
                } catch (error) {
                    contentDiv.className = 'error';
                    contentDiv.innerHTML = `Error loading barcode: ${error.message}`;
                    document.body.removeChild(iframe);
                }
            };
            
            iframe.onerror = function() {
                contentDiv.className = 'error';
                contentDiv.innerHTML = 'Error loading barcode generator';
                document.body.removeChild(iframe);
            };
            
            iframe.src = generatorUrl;
            document.body.appendChild(iframe);
        } else {
            contentDiv.className = 'error';
            contentDiv.innerHTML = `
                No barcode text provided.<br><br>
                <strong>Usage:</strong> Add ?text=YOUR_TEXT to the URL<br>
                <strong>Optional parameters:</strong> &type=CODE128&width=2&height=100<br>
                <strong>Example:</strong> ${window.location.href}?text=123456789&type=CODE39&width=3&height=150<br><br>
                <strong>Supported types:</strong> CODE128, CODE39, EAN13, EAN8, UPC, ITF14, MSI, pharmacode
            `;
        }
    </script>
</body>
</html>
